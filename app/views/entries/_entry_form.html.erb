<section aria-labelledby="entry-heading" class="w-full">
  <div class="relative mx-auto w-full max-w-xl bg-white p-6 md:p-8 rounded-2xl ring-1 ring-gray-950/5 shadow-sm">
    <% key = entry.persisted? ? dom_id(entry) : "#{dom_id(entry)}-#{SecureRandom.hex(3)}" %>
    <% dd_id  = "dropdownDots-#{key}" %>
    <% btn_id = "dropdownMenuIconButton-#{key}" %>
    <button id="<%= btn_id %>"
        data-dropdown-toggle="<%= dd_id %>"
        type="button"
        class="inline-flex absolute right-6 top-6 md:right-8 md:top-8 items-center p-2 text-sm font-medium text-center text-gray-900 bg-white rounded-lg hover:bg-gray-100 focus:ring-4 focus:outline-none dark:text-white focus:ring-gray-50 dark:bg-gray-800 dark:hover:bg-gray-700 dark:focus:ring-gray-600">
      <!-- icon -->
      <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 4 15">
        <path d="M3.5 1.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm0 6.041a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm0 5.959a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z"/>
      </svg>
    </button>
    <div id="<%= dd_id %>"
     class="z-50 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-sm w-44 dark:bg-gray-700 dark:divide-gray-600">
      <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="<%= btn_id %>">
        <% unless entry.new_record? %>
          <li>
            <%= link_to "Add New Entry", new_entry_path,
              data: { turbo_frame: "main-dashboard" },
              class: "block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" %>
          </li>
          <li>
            <%= link_to "Delete Entry", entry_path(entry),
              data: { turbo_method: :delete, turbo_confirm: "Are you sure?", turbo_frame: "main-dashboard" },
              class: "block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" %>
          </li>
        <% end %>
        <li><a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Settings</a></li>
        <li><a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Earnings</a></li>
      </ul>
      <div class="py-2">
        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Separated link</a>
      </div>
    </div>
    <% title_text = entry.new_record? ? "Create New Entry" : entry.name %>
    <header class="mb-6 md:mb-8">
      <h2 id="entry-heading" class="text-2xl md:text-3xl font-semibold tracking-tight text-gray-900 text-center">
        <% unless entry.new_record? %>
          <div class="mb-3">
            <%= render partial: "entries/entry_image", locals: { entry: entry } %>
          </div>
        <% end %>
        <%= title_text %>
      </h2>
      <% unless entry.new_record? %>
        <p class="mt-1 text-center text-sm text-gray-500">Edit and update the details below.</p>
      <% end %>
    </header>
    <% if entry.errors.any? %>
      <div class="mb-6 rounded-lg border border-red-200 bg-red-50/70 p-4">
        <div class="flex items-start gap-2">
          <svg class="h-5 w-5 text-red-600 mt-0.5 flex-shrink-0" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 8v4m0 4h.01M12 3a9 9 0 100 18 9 9 0 000-18z" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div>
            <h3 class="text-sm md:text-base font-medium text-red-800">
              Please fix the following <%= pluralize(entry.errors.count, "error") %>:
            </h3>
            <ul class="mt-1.5 list-disc list-inside space-y-1 text-sm md:text-base text-red-700">
              <% entry.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    <% end %>
    <%= form_with model: entry, html: { class: "space-y-6" } do |f| %>
      <% name_error     = entry.errors[:name].present? %>
      <% url_error      = entry.errors[:url].present? %>
      <% username_error = entry.errors[:username].present? %>
      <% password_error = entry.errors[:password].present? %>
      <!-- Name -->
      <div class="relative">
        <%= f.text_field :name,
              placeholder: " ",
              autocomplete: "name",
              required: true,
              "aria-invalid": name_error,
              class: "peer block w-full rounded-lg border bg-white
                      px-3 pt-6 pb-2 md:px-4 md:pt-7 md:pb-2
                      text-sm md:text-base text-gray-900 shadow-xs
                      focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-0
                      transition #{name_error ? 'border-red-400 focus-visible:ring-red-500' : 'border-gray-300 focus:border-blue-500 focus-visible:ring-blue-500'}" %>
        <%= f.label :name, "Name",
              class: "absolute left-3 md:left-4 top-2 text-gray-500 text-sm md:text-base transition-all
                      peer-placeholder-shown:top-6 md:peer-placeholder-shown:top-7
                      peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-sm
                      peer-focus:top-2 peer-focus:text-xs peer-focus:text-blue-600" %>
        <% if name_error %>
          <p class="mt-1 text-xs text-red-600"><%= entry.errors[:name].first %></p>
        <% end %>
      </div>
      <!-- URL -->
      <div class="relative">
        <%= f.url_field :url,
              placeholder: " ",
              autocomplete: "url",
              required: true,
              "aria-invalid": url_error,
              class: "peer block w-full rounded-lg border bg-white
                      px-3 pt-6 pb-2 md:px-4 md:pt-7 md:pb-2
                      text-sm md:text-base text-gray-900 shadow-xs
                      focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-0
                      transition #{url_error ? 'border-red-400 focus-visible:ring-red-500' : 'border-gray-300 focus:border-blue-500 focus-visible:ring-blue-500'}" %>
        <%= f.label :url, "URL",
              class: "absolute left-3 md:left-4 top-2 text-gray-500 text-sm md:text-base transition-all
                      peer-placeholder-shown:top-6 md:peer-placeholder-shown:top-7
                      peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-sm
                      peer-focus:top-2 peer-focus:text-xs peer-focus:text-blue-600" %>
        <% if url_error %>
          <p class="mt-1 text-xs text-red-600"><%= entry.errors[:url].first %></p>
        <% end %>
      </div>
      <% if entry.persisted? && entry.url.present? %>
        <% visit_url = entry.url.to_s.match?(/\Ahttps?:\/\//i) ? entry.url : "https://#{entry.url}" %>
        <div class="mt-1.5">
          <%= link_to visit_url,
              target: "_blank", rel: "noopener noreferrer",
              class: "group inline-flex items-center gap-1 text-sm font-medium text-blue-700 hover:text-blue-800" do %>
            <svg class="h-4 w-4 -mt-px" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M7 17L17 7M9 7h8v8" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="underline decoration-1 underline-offset-2 truncate max-w-[22rem] md:max-w-[28rem]"><%= entry.url %></span>
          <% end %>
        </div>
      <% end %>
      <!-- Username -->
      <div class="relative">
        <%= f.text_field :username,
              placeholder: " ",
              autocomplete: "username",
              required: true,
              "aria-invalid": username_error,
              class: "peer block w-full rounded-lg border bg-white
                      px-3 pt-6 pb-2 md:px-4 md:pt-7 md:pb-2
                      text-sm md:text-base text-gray-900 shadow-xs
                      focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-0
                      transition #{username_error ? 'border-red-400 focus-visible:ring-red-500' : 'border-gray-300 focus:border-blue-500 focus-visible:ring-blue-500'}" %>
        <%= f.label :username, "Username",
              class: "absolute left-3 md:left-4 top-2 text-gray-500 text-sm md:text-base transition-all
                      peer-placeholder-shown:top-6 md:peer-placeholder-shown:top-7
                      peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-sm
                      peer-focus:top-2 peer-focus:text-xs peer-focus:text-blue-600" %>
        <% if username_error %>
          <p class="mt-1 text-xs text-red-600"><%= entry.errors[:username].first %></p>
        <% end %>
      </div>
      <!-- Password -->
      <div class="relative">
        <%= f.password_field :password,
              placeholder: " ",
              autocomplete: "new-password",
              required: true,
              "aria-invalid": password_error,
              class: "peer block w-full rounded-lg border bg-white
                      px-3 pt-6 pb-2 md:px-4 md:pt-7 md:pb-2
                      text-sm md:text-base text-gray-900 shadow-xs
                      focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-0
                      transition #{password_error ? 'border-red-400 focus-visible:ring-red-500' : 'border-gray-300 focus:border-blue-500 focus-visible:ring-blue-500'}" %>
        <%= f.label :password, "Password",
              class: "absolute left-3 md:left-4 top-2 text-gray-500 text-sm md:text-base transition-all
                      peer-placeholder-shown:top-6 md:peer-placeholder-shown:top-7
                      peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-sm
                      peer-focus:top-2 peer-focus:text-xs peer-focus:text-blue-600" %>
        <% if password_error %>
          <p class="mt-1 text-xs text-red-600"><%= entry.errors[:password].first %></p>
        <% end %>
      </div>
      <% if entry.persisted? %>
        <fieldset class="mt-2 rounded-lg border border-gray-200 bg-gray-50/60 px-3 py-3 md:px-4 md:py-3">
          <legend class="px-1 text-xs font-medium text-gray-500">Meta</legend>
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <!-- Last updated -->
            <div class="flex items-center gap-2 text-gray-700">
              <svg class="h-4 w-4 md:h-5 md:w-5 text-blue-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 8v4l3 3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 21a9 9 0 11 0-18 9 9 0 010 18Z" stroke="currentColor" stroke-width="1.8"/>
              </svg>
              <span class="text-xs md:text-sm font-medium">Last updated</span>
              <time datetime="<%= entry.updated_at.iso8601 %>" title="<%= format_time(entry.updated_at) %>"
                    class="text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-white border border-gray-200">
                <%= time_ago_in_words(entry.updated_at) %> ago
              </time>
            </div>
            <div class="hidden sm:block h-5 w-px bg-gray-200"></div>
            <!-- Created -->
            <div class="flex items-center gap-2 text-gray-700">
              <svg class="h-4 w-4 md:h-5 md:w-5 text-emerald-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M7 3v4M17 3v4M4 9h16M6 21h12a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2Z" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span class="text-xs md:text-sm font-medium">Created</span>
              <time datetime="<%= entry.created_at.iso8601 %>" title="<%= format_time(entry.created_at) %>"
                    class="text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-white border border-gray-200">
                <%= time_ago_in_words(entry.created_at) %> ago
              </time>
            </div>
          </div>
        </fieldset>
      <% end %>
      <!-- Actions -->
      <div class="pt-1 md:pt-2 flex flex-col gap-3">
        <%= f.submit (entry.new_record? ? "Create New Entry" : "Update Entry"),
            class: "inline-flex justify-center items-center gap-2 w-full rounded-lg bg-blue-600 px-4 md:px-6 py-2.5 md:py-3
                    text-white text-sm md:text-base font-medium shadow-sm
                    hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600
                    focus-visible:ring-offset-2 transition" %>
        <%= link_to (entry.new_record? ? entries_path : entry_path(entry)),
            class: "inline-flex justify-center items-center gap-2 w-full rounded-lg border border-gray-300 bg-white
                    px-4 md:px-6 py-2.5 md:py-3 text-gray-700 text-sm md:text-base font-medium
                    hover:bg-gray-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-300
                    focus-visible:ring-offset-2 transition" do %>
          Cancel
        <% end %>
      </div>
    <% end %>
  </div>
</section>